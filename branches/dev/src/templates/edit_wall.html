<html>
<head>
<link rel="stylesheet" type="text/css" href="/static/css/main.css"/>
<link type="text/css" href="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8.2/themes/le-frog/jquery-ui.css" rel="stylesheet" />	
<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.min.js"></script>
<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8.2/jquery-ui.min.js"></script>
<script type="text/javascript" src="/static/js/pdbAjax.js"></script>
<script type="text/javascript" src="/static/js/pdb_client_old.js"></script>

<script type="text/javascript">
function NameValidator(){
	nameList = new Array({% for w in walls %}{%if not forloop.first %},{% endif %}'{{w.name }}' {% endfor %});
	function isUnique(name){
		result = true;
		for(var i = 0 ; i<nameList.length;i++){
			if (nameList[i] === name ){
				result = false;
				break;
			}
		}//for
		return result;
	}//function isUniqueName
	this.isUnique = isUnique;
}

$(function(){
	$("#mainTabs").tabs();
	$("#submitButton").button();
	$("#cancelButton").button();
	
});
</script>
<script type="text/javascript" src="/static/js/wall_validation.js">
</script>
</head>
<body>
<div class="main">
<h1>Edit Wall</h1>
<a href="/settings">Return to settings page</a>
<hr>
<form action="{{ actionUrl }}" method="post" name="WallForm" onsubmit="return wallFormOnSubmit(this,new NameValidator())">
{%if wall%}<input type="hidden" name="id" value="{{ wall.key.id }}">{% endif %}
<!-- Main Tabs -->
<div id="mainTabs">
	<ul>
		<li><a href="#general">General</a></li>
		<li><a href="#generalStyle">General Style</a></li>
		<li><a href="#formAttributes">Form Attributes</a></li>
		<li><a href="#postStyle">Post Style</a></li>
		<li><a href="#dateStyle">Date Style</a></li>

	</ul>
<!-------------General Tab-------------->
	<div id="general">
		<table class="ui-widget ui-widget-content">
			<tr>
				<td>Wall Name</td>  
				<td><input type="text" name="wallName" maxlength="50" value="{{ wall.name }}"></td>
				<td><div id="wallNameAlert" class="validation_error"></div></td>
			</tr>
			<tr>
			 	<td>Posts Per Page</td>
				<td><input type="text" name="pageSize" maxlength="50" value="{% if wall.pageSize%}{{ wall.pageSize }}{%else%}10{%endif%}"></td>
				<td><div id="pageSizeAlert" class="validation_error"></div></td>
			</tr>
			<tr><td colspan="3">
				<input type="checkbox" name="allowEntry" value="True" {%if wall.allowEntry%}checked="checked"{%endif%} {%if not wall%}checked="checked"{%endif%}/>Allow Entries from outside of the website.<br>
				If you uncheck this, clients will not be able to send posts but only display them.<br>
				We recommend to uncheck this only for blog style walls.<br>
				This options also enables you to use html tags within posts.
			</td></tr>
			<tr><td colspan="3">
				<input type="checkbox" name="allowRead" value="True" {%if wall.allowRead%}checked="checked"{%endif%} {%if not wall%}checked="checked"{%endif%}/>Allow people to read posts from your wall.<br>
				If you uncheck this, clients will not be able to display posts.
			</td></tr>
			<tr><td colspan="3">
				<input type="checkbox" name="allowHtml" value="True" {%if wall.allowHtml%}checked="checked"{%endif%}/>Allow Html tags work in posts<br>
				If you check this posters will be able to control pages with java script. we recommend to use this only in Blog Style Walls.
			</td></tr>
			<tr><td colspan="3">
				<input type="checkbox" name="emailOnSubmit" value="True" {%if wall.emailOnSubmit%}checked="checked"{%endif%}/>email new submited posts.<br>
				If you check this we will send you an email whenever you got new post on this wall. we will also keep the post on our database.<br>
				you can still come to this page and see the posts if you want to.This is recomendend if you have only an entry form on your page.
			</td></tr>
			<tr><td colspan="3">
			<input type="checkbox" name="lastSavedFirst" value="True" {%if wall.lastSavedFirst%}checked="checked"{%endif%} {%if not wall%}checked="checked"{%endif%}/>Show Last Posted text first.<br>
			if you uncheck this order will be reversed.(first post will be shown first)
			</td></tr>
		</table>

	</div>
	<!------------General tabs------------->
	<div id="generalStyle">
		<table class="ui-widget ui-widget-content">
		<tr><td><input type="radio" name="wallStyle" value="1" {% ifequal wall.wallStyle 1%}checked="checked"{%endifequal%} {%if not wall.wallstyle%}checked="checked"{%endif%}/>Standart Post(first an entry form and than a post list)</td></tr>
		<tr><td><input type="radio" name="wallStyle" value="2" {% ifequal wall.wallStyle 2%}checked="checked"{%endifequal%}/>Only an entry form(you can use this instead of giving your email address)</td></tr>
		<tr><td><input type="radio" name="wallStyle" value="3" {% ifequal wall.wallStyle 3%}checked="checked"{%endifequal%}/>Blog Style(only post data, no entry form.If you choose this. please also close entries from outside.)</td></tr>
		<tr><td><input type="radio" name="wallStyle" value="4" {% ifequal wall.wallStyle 4%}checked="checked"{%endifequal%}/>Standart Post(Reversed version - first post list and then  an entry form)</td></tr>
		</table>
	</div>
	<div id="formAttributes">
		<table class="ui-widget ui-widget-content">
		<tr>
		 	<td>Nick Label</td>
			<td><input type="text" name="nickLabel" maxlength="50" value="{% if wall.nickLabel%}{{ wall.nickLabel }}{%else%}Name{%endif%}"></td>
			<td><div id="nickLabelAlert" class="validation_error"></div></td>
		</tr>
		<tr>
		 	<td>Nick2 Label</td>
			<td><input type="text" name="nick2Label" maxlength="50" value="{% if wall.nick2Label%}{{ wall.nick2Label }}{%else%}Last Name{%endif%}"></td>
			<td><div id="nick2LabelAlert" class="validation_error"></div></td>
		</tr>
		<tr>
		 	<td>Post Area Label</td>
			<td><input type="text" name="postAreaLabel" maxlength="50" value="{% if wall.postAreaLabel%}{{ wall.postAreaLabel }}{%else%}Post{%endif%}"></td>
			<td><div id="postAreaLabelAlert" class="validation_error"></div></td>
		</tr>
		<tr>
		 	<td>Post Button Label</td>
			<td><input type="text" name="postButtonLabel" maxlength="50" value="{% if wall.postButtonLabel%}{{ wall.postButtonLabel }}{%else%}Post{%endif%}"></td>
			<td><div id="postButtonLabelAlert" class="validation_error"></div></td>
		</tr>
		<tr>
		 	<td>Reset Button Label</td>
			<td><input type="text" name="resetButtonLabel" maxlength="50" value="{% if wall.resetButtonLabel%}{{ wall.resetButtonLabel }}{%else%}Clear Form{%endif%}"></td>
			<td><div id="resetButtonLabelAlert" class="validation_error"></div></td>
		</tr>
		<tr>
		 	<td>Post Area Height</td>
			<td><input type="text" name="formHeight" maxlength="50" value="{% if wall.formHeight%}{{ wall.formHeight }}{%else%}5{%endif%}"></td>
			<td><div id="formHeightAlert" class="validation_error"></div></td>
		</tr>
		<tr>
		 	<td>Post Area Width</td>
			<td><input type="text" name="formWidth" maxlength="50" value="{% if wall.formWidth%}{{ wall.formWidth }}{%else%}100{%endif%}"></td>
			<td><div id="formWidthAlert" class="validation_error"></div></td>
		</tr>
		</table>
	</div>
	<div id="postStyle">
				<table class="ui-widget ui-widget-content">
				<tr><td><input type="radio" name="postStyle" value="1" {% ifequal wall.postStyle 1%}checked="checked"{%endifequal%} {%if not wall.postStyle%}checked="checked"{%endif%}/>Standart Post: nick nick2 [date] as header and post in the bottom</td></tr>
				<tr><td><input type="radio" name="postStyle" value="2" {% ifequal wall.postStyle 2%}checked="checked"{%endifequal%}/>No Header Post: Prints only post value and no line after the post</td></tr>
				<tr><td><input type="radio" name="postStyle" value="3" {% ifequal wall.postStyle 3%}checked="checked"{%endifequal%}/>NoHeader Post with horizontal line: Prints post and a horizontal line after it</td></tr>
				<tr><td><input type="radio" name="postStyle" value="4" {% ifequal wall.postStyle 4%}checked="checked"{%endifequal%}/>Titled Post: Uses nick as title</td></tr>
				<tr><td><input type="radio" name="postStyle" value="5" {% ifequal wall.postStyle 5%}checked="checked"{%endifequal%}/>Indipendent Post: Every Form is in its on table</td></tr>
				<tr><td><input type="radio" name="postStyle" value="6" {% ifequal wall.postStyle 6%}checked="checked"{%endifequal%}/>Dated Post:date on top right corner</td></tr>
				<tr><td><input type="radio" name="postStyle" value="7" {% ifequal wall.postStyle 7%}checked="checked"{%endifequal%}/>Dated Post(footnote): date on bottom right corner.</td></tr>
				</table>
	</div>
	<div id="dateStyle">
				<table class="ui-widget ui-widget-content">
				<tr><td><input type="radio" name="dateStyle" value="1" {% ifequal wall.dateStyle 1%}checked="checked"{%endifequal%} {%if not wall.dateStyle%}checked="checked"{%endif%}/>Date Time: [Wednesday, June 03, 2009 - 9:29:54 AM] </td></tr>
				<tr><td><input type="radio" name="dateStyle" value="2" {% ifequal wall.dateStyle 2%}checked="checked"{%endifequal%}/>Date Time (No paranthesis): Wednesday, June 03, 2009 - 9:29:54 AM</td></tr>
				<tr><td><input type="radio" name="dateStyle" value="3" {% ifequal wall.dateStyle 3%}checked="checked"{%endifequal%}/>Date: [Wednesday, June 03, 2009]</td></tr>
				<tr><td><input type="radio" name="dateStyle" value="4" {% ifequal wall.dateStyle 4%}checked="checked"{%endifequal%}/>Date (No paranthesis): Wednesday, June 03, 2009</td></tr>
				<tr><td><input type="radio" name="dateStyle" value="5" {% ifequal wall.dateStyle 5%}checked="checked"{%endifequal%}/>Long Date: [Wed Jun 03 2009 15:53:51 GMT+0300 (GTB Daylight Time)]</td></tr>
				<tr><td><input type="radio" name="dateStyle" value="6" {% ifequal wall.dateStyle 6%}checked="checked"{%endifequal%}/>Long Date: (No paranthesis): Wed Jun 03 2009 15:53:51 GMT+0300 (GTB Daylight Time)</td></tr>
				<tr><td><input type="radio" name="dateStyle" value="7" {% ifequal wall.dateStyle 7%}checked="checked"{%endifequal%}/>Interval: [3 days ago]</td></tr>
				<tr><td><input type="radio" name="dateStyle" value="8" {% ifequal wall.dateStyle 8%}checked="checked"{%endifequal%}/>Interval (No paranthesis): 3 days ago</td></tr>
				</table>
	</div>
</div>
	<input type="submit" name="submit" value="OK" id="submitButton"/>
	<input type="button" value="Cancel" onclick="cancelChanges('/settings')" id="cancelButton"></input>
</form>









<ul>
	<li>Wall name must be unique. if you dont give it a unique name,your wall will not be created.</li>
	<li>Only Letters and numbers are allowed on wall name.</li>
	<li>Wall name can not be null</li>
</ul>

{ % include "wallForm.html" %}
Number of posts:{{post_number}} - <a href="/wall/clear?id={{ wall.key.id }}">Clear all posts</a>
<script type="text/javascript">
	c = new PDBAjaxConnection({{ wall.key.id }});
	c.post = function(callback,postValue,nick,nick2,id){
			var url = '/post/save'
			var data = 'id='+this.wallid;

			if(postValue){
				data += '&post=' + encodeURI(postValue); 
			}
			if(nick){
				data += '&nick=' + encodeURI(nick); 
			}
			if(nick2){
				data += '&nick2=' + encodeURI(nick2); 
			}
			if(id){
				data += '&postid=' + encodeURI(id); 
			}
			this.downloadURL(url,'POST',callback,data);
		}
	document.writeln('<div id="pdbDiv{{ wall.key.id }}"></div>');
	w = new PDBWizard(c,'w',document.getElementById('pdbDiv{{ wall.key.id }}'));
	w.getPostString =function (id,nick,nick2,date,value,order){
		var txt ='<tr><td><table border="1" class="list"><tr><td>';
		txt +='<tr><td colspan="2">' + this.nickLabel +'</td><td colspan="2">'+nick+'</tr>';
		txt +='<tr><td colspan="2">' + this.nick2Label +'</td><td colspan="2">'+nick2+'</tr>';
		txt +='<tr><td colspan="4">' + date + '</td></tr>';
		txt +='<tr><td colspan="4"><fieldset><legend>'+ this.postAreaLabel +'</legend>' + value + '</fieldset></td></tr>';
		txt +='<tr><td><input type="button" value="Move Up" onclick="javascript:'+ this.variableName +'.movePost('+ id +','+((order+1+(this.pageNumber-1)*this.pageSize)-1)+')" ';
		if (i==0){
			txt += ' disabled="disabled"/></td>';
		}else{
			txt += '/></td>'
		}
		txt +='<td><input type="button" value="Move Down" onclick="javascript:'+ this.variableName +'.movePost('+ id +','+((order+1+(this.pageNumber-1)*this.pageSize)+1)+')" ';
		if (i==this.wall.posts.length-1){
			txt += ' disabled="disabled"/></td>';
		}else{
			txt += ' /></td>'
		}
		txt +='<td><input type="button" value="Edit" onclick="javascript:'+ this.variableName +'.editPost('+ id +')"/></td>';
		txt +='<td><input type="button" value="Delete" onclick="javascript:'+ this.variableName +'.deletePost('+ id +')"/></td>';
		txt +='</table></td></tr>';
		return txt;
	}
	w.getPrePostString = function (wall){
		return '<table><tr><th>Posts on this wall</th></tr><tr><td>' + this.getPageList(wall) + '</td></tr>';
	}
	w.getPostPostString =	function (wall){
			return '<tr><td colspan="3">' + this.getPageList(wall) + '</td><tr></table>';
	}

	w.movePost = function(id,targetOffset){
		this.pDBConnection.movePost(this.variableName +'.movePostCallBack' , id ,targetOffset);
	}
	w.movePostCallBack = function(result){
		if(result){
			w.printPosts(this.wall.currentPage,this.wall.postsPerPage);
		}else
		{
			alert('Server Error: Post Could not be moved');
		};
	}
	w.deletePost = function(id){
		this.pDBConnection.deletePost(this.variableName +'.deletePostCallBack' , id);
	}
    w.deletePostCallBack = function(result){
    		if(result){
    			w.printPosts(this.wall.currentPage,this.wall.postsPerPage);
    		}else
    		{
    			alert('Server Error: Post Could not be deleted');
    		};
    	}

	w.printForm = function(){
		//set postButtonLbl
		var postButtonLbl = 'Post';
		if (this.postButtonLabel){
			postButtonLbl = this.postButtonLabel;
		}
		var resetButtonLbl = 'Clear Form';
		if (this.resetButtonLabel){
			resetButtonLbl = this.resetButtonLabel;
		}
		
		//set PostLbl
		var txt = '<form id="pdbForm_'+this.pDBConnection.wallid+'">';
		txt += '<input type="hidden" name="pdbId" value="">';
		if(this.nickLabel != null){
			txt += this.nickLabel + ' <input type="text" name="pdbNick" maxlength="50"><br>';
		}
		if(this.nick2Label != null){
			txt += this.nick2Label + ' <input type="text" name="pdbNick2" maxlength="50"><br>';
		}
		if(this.postAreaLabel != null){
			txt += this.postAreaLabel + '<br>';
		}
		txt +='<TEXTAREA cols="'+this.formWidth+'" rows="'+this.formHeight+'" name="pdbPost" ></TEXTAREA><br>';
		txt +='<input type="button" name="pdbSubmitButton" value="'+ postButtonLbl +'" onclick=\"javascript:'+ this.variableName +'.submitFormValues('+this.variableName+'.pdbForm.pdbNick.value,'+this.variableName+'.pdbForm.pdbNick2.value,'+this.variableName+'.pdbForm.pdbPost.value,'+this.variableName+'.pdbForm.pdbId.value)\"/>';
		txt +='<input type="button" name="reset" value="'+ resetButtonLbl +'" onclick=\"javascript:'+this.variableName+'.clearForm();"/>';
		txt +='</form>';
		this.formDiv.innerHTML = txt;
		this.pdbForm = document.getElementById('pdbForm_'+this.pDBConnection.wallid);
	}	

	w.clearForm=function(){
		this.pdbForm.pdbNick.value='';
		this.pdbForm.pdbNick2.value='';
		this.pdbForm.pdbPost.value='';
		this.pdbForm.pdbId.value='';
	}

    w.editPost = function(id){
		this.pdbForm.pdbNick.value=this.wall.getbyid(id).nick;
		this.pdbForm.pdbNick2.value=this.wall.getbyid(id).nick2;
		this.pdbForm.pdbPost.value=this.wall.getbyid(id).value;
		this.pdbForm.pdbId.value=this.wall.getbyid(id).id;
	}

	w.submitFormValues = function(nick,nick2,post,id){
		this.pDBConnection.post(this.variableName+'.submitFormValues_callback',w.replacesc(post),w.replacesc(nick),w.replacesc(nick2),id);
	}

	w.initWall();
</script>
</div>
</body>
</html>
